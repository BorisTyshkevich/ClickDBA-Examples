## Practical notes
- ClickHouse supports SQL-style updates via `ALTER TABLE ... UPDATE` (mutation-based) since 2018.
- Classic mutations rewrite affected column files for matching parts; unchanged columns may be hard-linked (no data copy for those columns).
- By default, `ALTER TABLE ... UPDATE` runs asynchronously; ClickHouse may fuse multiple updates into a single mutation.
- `DELETE` can be implemented as a “lightweight delete” by updating a mask column `_row_exists = 0`; rows with `_row_exists = 0` are excluded from query results and are physically removed on a later background merge.
- “On-the-fly mutations” can make UPDATE results visible immediately by storing the update expression in memory and applying it at read time, while the actual part rewrite still runs in the background.

## Settings & knobs
- Not specified in this chunk (no concrete flags/settings/values mentioned).

## Examples
```sql
ALTER TABLE orders
UPDATE quantity = 60, discount = 0.20
WHERE order_id = 1001 AND item_id = 'mouse';
```

```sql
DELETE FROM orders
WHERE order_id = 1001 AND item_id = 'mouse';
-- internally becomes:
-- ALTER TABLE orders UPDATE _row_exists = 0 WHERE ...
```
- Table example used: `ENGINE = MergeTree ORDER BY (order_id, item_id)`.

## Gotchas
- Mutations are heavyweight: affected columns are rewritten for impacted parts.
- Visibility delay (classic mutations): changes aren’t visible until the background mutation completes.
- Execution ordering: mutations must wait for prior merges/mutations to finish (can be surprising).
- On-the-fly mutations: many accumulated updates can slow `SELECT`.
- On-the-fly mutations: limited support for subqueries and non-determinism.

## Verification
- Verify behavior by selecting matching rows before/after the change and confirming:
  - For classic mutations, results may not change until the background mutation completes.
  - For on-the-fly mutations, updated values can appear immediately in `SELECT`.
  - For lightweight deletes, deleted rows are filtered from results once `_row_exists = 0` is applied; physical removal happens on a later background merge.